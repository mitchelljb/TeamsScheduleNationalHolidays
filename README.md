# Public Holidays Management for Microsoft Teams Schedule

This PowerShell script automates the management of public holidays in Microsoft Teams schedules. It fetches public holiday data from an external API and updates the designated schedule in Microsoft Teams accordingly.

##

Author: Simon Jackson (@sjackson0109)
Date: 10/02/2024
Special Thanks: Bjoren Dassow (@dassbj01) for a hint to use the `date.nager.at` REST api service. 


## Features

- **Dynamic Holiday Retrieval**: The script fetches public holiday data dynamically from an external API based on the provided country code and year.
- **Schedule Update**: It updates the specified Microsoft Teams schedule with the fetched public holidays, ensuring the schedule is up-to-date. TIP: Dozens of call flows (auto-attendants), can have an out-of-holidays action attached to a single schedule - giving one table of holidays to update!
- **Modular Design**: The code is modularized with separate functions for fetching data and updating the schedule, making it easy to maintain and reuse.

## How to Use

1. **Prerequsites**: Ensure that you have the required PowerShell modules installed, imported and logged into the correct Tenant:
    ```powershell
      Install-Module MicrosoftTeams
      Import-Module MicrosoftTeams
      Connect-MicrosoftTeams
    ```
3. **Debugging** (optional): The `$DebugPreference` global variable in PowerShell controls how the PowerShell runtime handles Write-Debug messages generated by scripts or cmdlets. Debug messages are useful for troubleshooting and understanding the flow of a script's execution. The DebugPreference allows users to define the behavior of PowerShell when encountering these debug messages.
    ```powershell
    $DebugPreference = "[Option]"
    ```
    [Option]<Options> choices include
    - **SilentlyContinue**: Suppresses all debug messages and continues without interruption.
    - **Stop**: Halts execution when a debug message is encountered, allowing the user to investigate.
    - **Inquire**: Prompts the user to decide whether to continue or stop when a debug message is encountered.
    - **Continue**: Displays debug messages but continues execution without interruption.
    - **Ignore**: Ignores all debug messages and continues without interruption.
2. **Import the PS1 Module**: Import the PowerShell script into your environment using:
    ```powershell
    Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope Process
    Import-Module .\TeamsPublicHolidays.ps1
    ```
    Note: One-day we will look to sign the ps1 file so the Set-ExecutionPolicy command can be skipped.

4. **Execute the Script**: Run the `Create-TeamsPublicHolidays` or `Update-TeamsPublicHolidays` function(s) with the desired parameters to create/update the appropriate parameters; from this list:
    - ScheduleName: Specifies the name of the Microsoft Teams schedule to be updated or created.
    - CountryCode: Specifies the country code for which public holidays should be fetched. Use the country code list to find the appropriate code.
    - Year: (Optional) Specifies the year for which public holidays should be fetched. If not provided, the current year is used by default.
    - Append: (Optional) If included, the fetched holidays will be appended to the existing schedule without replacing any existing entries.

### Examples

1. Create a *new* Schedule called `UK National Holidays`, for the year `2024`, using the following:
- ```powershell
  Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope Process
  Import-Module .\TeamsPublicHolidays.ps1
  Update-TeamsPublicHolidays -ScheduleName 'UK National Holidays' -CountryCode 'GB' -Year 2024
  ```

2. Updating the *existing* Schedule called `DE National Holidays, use the following:
- ```powershell
  Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope Process
  Import-Module .\TeamsPublicHolidays.ps1
  Update-TeamsPublicHolidays -ScheduleName 'DE National Holidays' -CountryCode 'DE' -Year 2024 -Append
  ```

|Command|Result|
|---|---|
|![UK 2024 Command](/Examples/UK_2024.png)|![UK 2024 Result](/Examples/UK_2024_Result.png)|
|![DE 2024 Command](/Examples/DE_2024.png)|![DE 2024 Result](/Examples/DE_2024_Result.png)|


## Where do the country codes come from?
You can look up your country code (2-digits) from [here](https://www.iban.com/country-codes).

## Still have conflicting schedules?
Having experienced this issue myself, i figured i'd explain it.
```powershell
Correlation id for this request : 41825f04-a34b-4513-a905-43945ae17645
Microsoft.Teams.ConfigAPI.Cmdlets.internal\Set-CsOnlineSchedule : The changes made in Schedule 83e774b4-eabf-478f-914e-56966515a9b3 are causing conflicts with other schedules in Auto Attendant 70561269-5dc8-485c-b125-5a75ab90ebed. Error: Holidays within an auto
attendant cannot start at the same date-time.
```
**Explaination** We had `UK National Holidays` and `Company Closures` schedules attached to a single auto-attendant. I slipped a date when creating the `Company Closures` implying that both a national holiday and a company closure date overlapped. That isn't possible for the Microsoft Teams Call-Flow to logically process. Imagine the National Holidays action sending to voicemail, and the Company Closures forwarding to a mobile.. Which one would MS Teams Auto-Attendant use? Microsoft's API clealy checks for this scenario, hence the above error message. 
Solution: Ensure both schedules don't have any overlapping/conflicting dates.
